---
interface Props {
  command: string;
  label?: string;
  showPrompt?: boolean;
}

const { command, label, showPrompt = true } = Astro.props;
---

<div class="copyable-command group relative rounded-lg border border-slate-800 bg-navy-900 p-4 text-left">
  {label && <p class="mb-2 text-xs font-medium text-slate-500">{label}</p>}
  <div class="flex items-center justify-between gap-4">
    <code class="text-sm text-primary-400">
      {showPrompt && <span class="select-none text-slate-500">&gt; </span>}
      <span class="command-text">{command}</span>
    </code>
    <button
      type="button"
      class="copy-btn shrink-0 rounded p-1.5 text-slate-500 transition-colors hover:bg-slate-800 hover:text-slate-300"
      data-command={command}
      aria-label="Copy command"
    >
      <svg class="copy-icon h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z" />
      </svg>
      <svg class="check-icon hidden h-4 w-4 text-green-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
      </svg>
    </button>
  </div>
</div>

<script>
  document.querySelectorAll('.copy-btn').forEach((btn) => {
    btn.addEventListener('click', async () => {
      const command = btn.getAttribute('data-command');
      if (!command) return;

      try {
        await navigator.clipboard.writeText(command);

        const copyIcon = btn.querySelector('.copy-icon');
        const checkIcon = btn.querySelector('.check-icon');

        if (copyIcon && checkIcon) {
          copyIcon.classList.add('hidden');
          checkIcon.classList.remove('hidden');

          setTimeout(() => {
            copyIcon.classList.remove('hidden');
            checkIcon.classList.add('hidden');
          }, 2000);
        }
      } catch (err) {
        console.error('Failed to copy:', err);
      }
    });
  });
</script>
